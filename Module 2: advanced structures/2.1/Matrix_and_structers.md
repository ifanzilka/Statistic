# [Back](https://github.com/ifanzilka/Statistic_for_R/blob/main/Module%202:%20advanced%20structures/module2.md)

  ## Матрица
Матрица – двумерный массив данных одного типа

По сути, это вектор, уложенный по столбцам (!)

Для создания матрицы можно использовать функцию matrix

    matrix(1:6, nrow = 2, ncol = 3)
 #
    ##      [,1] [,2] [,3]
    ## [1,]    1    3    5
    ## [2,]    2    4    6


## Создание матриц

Избавимся от ненужной избыточности:

    matrix(1:6, nrow = 2)
#
    ##      [,1] [,2] [,3]  
    ## [1,]    1    3    5
    ## [2,]    2    4    6
Упокуем по строчкам

    matrix(1:6, nrow = 2, byrow = TRUE)
#
    ##      [,1] [,2] [,3]
    ## [1,]    1    2    3
    ## [2,]    4    5    6

Или так

    matrix(7:8, nrow = 2, ncol = 5)
#

    ##      [,1] [,2] [,3] [,4] [,5]
    ## [1,]    7    7    7    7    7
    ## [2,]    8    8    8    8    8


## Атрибут dim

    m <- matrix(1:6, ncol = 3)
    dim(m)
#
    ## [1] 2 3
Или так посмотреть размеры

    c(nrow(m), ncol(m))
#
    ## [1] 2 3

Превращаем в вектор:

    dim(m) <- NULL; m 
#
    ## [1] 1 2 3 4 5 6

Или так :
    
    dim(m) <- c(2, 3); m
#

    ##      [,1] [,2] [,3]
    ## [1,]    1    3    5
    ## [2,]    2    4    6


## Арифметические операторы

Действуют поэлементно, с учётом правил преписывания:

    m1 <- matrix(1:4, nrow = 2) 
    m2 <- matrix(c(1, 2, 2, 3), nrow = 2)
    m1 + m2
#
    ##      [,1] [,2]
    ## [1,]    2    5
    ## [2,]    4    7
Еще :
  
    m1 + 5
#
    ##      [,1] [,2]
    ## [1,]    6    8
    ## [2,]    7    9



## Арифметические операторы2
Умножение на число

    m1 * 2
#
    ##      [,1] [,2]
    ## [1,]    2    6
    ## [2,]    4    8

Умножение поэлементно
  
    m1 * m2
#
    ##      [,1] [,2]
    ## [1,]    1    6
    ## [2,]    4   12

Умножение в смысле линейной алгебры:

    m1 %*% m2
#
    ##      [,1] [,2]
    ## [1,]    7   11
    ## [2,]   10   16
#

    |a1    b1|        |c1    d1|          |a1c1 + b1c2    a1d1 + b1d2|
    |        |   *    |        |    =     |                          |
    |a2    b2|        |c2    d2|          |a2c1 + b2c2    a2d1 + b2d2|

## Индексирование матриц

Те же правила, что и для векторов, но с учётом двух размерностей:

    m <- matrix(1:10, ncol = 5)
    m[1, 3]
#
    ## [1] 5

Или так
    
    m[2, ]
#
    ## [1]  2  4  6  8 10
or

    m[, 4]
#
    ## [1] 7 8

Замена элемента

    m[1, ] <- 0;
    m
#
    ##      [,1] [,2] [,3] [,4] [,5]
    ## [1,]    0    0    0    0    0
    ## [2,]    2    4    6    8   10
OR

    m[, -5] <- 11:18; 
    m
#

    ##      [,1] [,2] [,3] [,4] [,5]
    ## [1,]   11   13   15   17    0
    ## [2,]   12   14   16   18   10



## Схлопывание размерности

    m <- matrix(1:10, ncol = 5)
    ind <- c(1, 3, 5)
    m[, ind]
#

    ##      [,1] [,2] [,3]
    ## [1,]    1    5    9
    ## [2,]    2    6   10
OR

    ind <- 3
    m[, ind]
#
    ## [1] 5 6

OR

drop для получение подматрциы а не вектора
    
    m[, ind, drop = FALSE]
#
    ##      [,1]
    ## [1,]    5
    ## [2,]    6

У TRUE и FALSE есть однобуквенные сокращения (T и F): drop = F


## Именованные матрицы: rownames/colnames

    m <- matrix(1:10, ncol = 5)
    rownames(m) <- c("row1", "row2")
    colnames(m) <- paste0("column", 1:5)
    m
paset0 склеивает аргументы    
#


    ##      column1 column2 column3 column4 column5
    ## row1       1       3       5       7       9
    ## row2       2       4       6       8      10
OR

    m["row1", c("column2", "column4"), drop = F]
#
    ##      column2 column4
    ## row1       3       7


## Присоединение матриц: rbind/cbind

    rbind(m1, m2)
# 
Присоединение по столбцам

    ##      [,1] [,2]
    ## [1,]    1    3
    ## [2,]    2    4
    ## [3,]    1    2
    ## [4,]    2    3

    cbind(m1, m2)
#
По строкам

    ##      [,1] [,2] [,3] [,4]
    ## [1,]    1    3    1    2
    ## [2,]    2    4    2    3



## Аргумент ... (ellipsis)

Новый аспект R: аргумент ... позволяет передавать любое количество объектов


    cbind(m1, m2, 1:2, c(5, 3), m2[, 1], m1 * 3, cbind(m2, m1))
#
    ##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
    ## [1,]    1    3    1    2    1    5    1    3    9     1     2     1     3
    ## [2,]    2    4    2    3    2    3    2    6   12     2     3     2     4

Другие примеры: c, paste, paste0, sum.

## Применение функций к матрице: apply

    m <- matrix(1:25, 5)
    f <- function(x) sum(x^2)

Три аргумента функции apply:

Массив (матрица)

Индекс (1 – по строкам, 2 – по столбцам)

Функция

Пример По строкам :

    apply(m, 1, f)
#
    ## [1]  855  970 1095 1230 1375
OR ПО столбцам

    apply(m, 2, f)
#
    ## [1]   55  330  855 1630 2655

## Применение функций к матрице: apply

    
    apply(m, 1:2, function(i) if (i>13) i else 13)
#

    ##      [,1] [,2] [,3] [,4] [,5]
    ## [1,]   13   13   13   16   21
    ## [2,]   13   13   13   17   22
    ## [3,]   13   13   13   18   23
    ## [4,]   13   13   14   19   24
    ## [5,]   13   13   15   20   25

или что тоже самое :

    m[m <= 13] <- 13; m
#

    ##      [,1] [,2] [,3] [,4] [,5]
    ## [1,]   13   13   13   16   21
    ## [2,]   13   13   13   17   22
    ## [3,]   13   13   13   18   23
    ## [4,]   13   13   14   19   24
    ## [5,]   13   13   15   20   25

Такая функция (не имеющая имени) называется анонимной


## rowSums, rowMeans, colSums, colMeans
## Наиболее частые операции по строкам и столбцам – sum и mean:

    m <- matrix(1:25, 5)
    rowSums(m)
#
    ## [1] 55 60 65 70 75

Проверим, что это действительно так:

    all.equal(rowSums(m), apply(m, 1, sum))
#

    ## [1] TRUE

OR

    all.equal(colMeans(m), apply(m, 2, mean))
#
    ## [1] TRUE



