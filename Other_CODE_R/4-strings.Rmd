---
title: "Строки"
author: "<i>Основы программирования на R</i><br><br>Антон Антонов"
output: 
  revealjs::revealjs_presentation:
    theme: serif
    highlight: tango
    center: false
    transition: fade
    pandoc_args: [ 
      "--slide-level", "1", 
      "--include-in-header", "custom.css"
    ]
---

```{r setup, echo=FALSE}
options(width = 110)
```

# Строки

>- Строка (string) -- это элемент вектора типа `character`
>- Большинство функций, оперирующих на строках, векторизованы

. . .

```{r}
s <- c("Терпение и труд всё перетрут", 
       "Кончил дело — гуляй смело", 
       "Без труда не вытащишь и рыбку из пруда",
       'Работа не волк, в лес не убежит')
```

```{r, echo=FALSE}
#s <- enc2utf8(s)
```
. . .

>- Как правило, для строк используют двойные кавычки
>- Одинарные кавычки тоже можно использовать: `'Операция "Ы"'`

. . .

```{r, echo=FALSE}
'Операция "Ы"'
```

# Функции `paste`/`paste0`

>- Выполняют конкатенацию строковых векторов с учётом правил переписывания
>- Аргумент `sep` -- разделитель между элементами (для `paste` по умолчанию пробел, для `paste0` -- пустая строка)
>- Аргумент `collapse` -- "схлопывает" вектор в одну строку

. . .

```{r}
paste(c("углекислый", "веселящий"), "газ")
```

. . .

```{r}
paste(c("углекислый", "веселящий"), "газ", sep = "_")
```
. . .

```{r}
paste(c("углекислый", "веселящий"), "газ", collapse = ", а также ")
```

# Функция `strsplit`

>- Выполняет разбиение строкового вектора
>- Результат -- список!

. . .

```{r}
strsplit(s, " и ", fixed = TRUE)
```

# Функция `strsplit`

. . .

Если не указывать аргумент `fixed` (по умолчанию `FALSE`), то строка, по которой проводится разбиение, будет рассматриваться как регулярное выражение:

. . .

```{r}
strsplit(s, "[[:punct:]]")
```

# Регулярные выражения

>- "Метаязык" поиска и манипуляции подстрок
>- Образец для поиска может включать обычные символы и т.н. _wildcards_

. . .

```{r}
grep("труд", s)
```

```{r}
grepl("труд", s)
```

. . .

```{r}
gsub("\\b[[:alpha:]]{4,5}\\b", "####",  s)
```

# Пакет `stringr`

. . .

```{r}
#install.packages("stringr")
library(stringr)
```

. . .

Пакет содержит множество функций для работы со строками. Эти функции векторизованы и являются consistent:

```{r}
str_extract(s, "н.")
```

. . .

```{r}
str_replace(s, "[иа]", "?")
```

# Пакет `stringr`

. . .

Ко многим функциям можно добавить `_all`, чтобы искать все вхождения, а не первое:

```{r}
str_extract_all(s, "н.")
```

. . .

```{r}
str_replace_all(s, "[иае]", "?")
```

# Функции `tolower`/`toupper`

. . .

Манипулирование регистром:
```{r}
tolower(month.name)
```

```{r}
toupper(month.abb)
```

# Пути к файлам

. . .

У сессии R есть понятие _рабочей директории_:
```{r}
getwd() 
head(list.files())
list.dirs("..", recursive = FALSE)
```

>- Смена рабочей директории -- функция `setwd`.
>- При создании нового проекта в RStudio рабочим каталогом становится тот, в котором расположен файл проекта, `.Rproj`
>- Под Windows разделителями каталогов могут быть либо `/`, либо `\\`

# Форматирование чисел

. . .

```{r}
c(pi, exp(pi))
```

. . .

```{r}
formatC(c(pi, exp(pi)), digits = 3)
```

. . .

```{r}
formatC(c(pi, exp(pi)), digits = 3, format = "e")
```

# Функция `cat`

>- Обычно для вывода неявно используется функция `print`
>- Функция `cat` печатает объекты "как есть"

. . .

```{r}
print('Операция "Ы"'); cat('Операция "Ы"')
```

. . .

```{r}
print("Трус\tБалбес\nБывалый"); cat("Трус\tБалбес\nБывалый")
```


# Глоссарий

. . .

`?paste`, `?paste0`, `?strsplit`

`?grep`, `?grepl`, `?gsub`

`library(stringr)`: `?str_extract`, `?str_replace`, +`_all`

`?tolower`, `?toupper`

`?getwd`, `?setwd`, `?list.dirs`, `?list.files`

`?formatC`, `?cat`